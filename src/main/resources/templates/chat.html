<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ðŸ’¬ Real-Time Chat Application</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
        body {
          background: radial-gradient(circle at top left, #1e1f29, #121212);
          font-family: "Segoe UI", sans-serif;
          color: #fff;
          height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .chat-container {
          width: 95%;
          max-width: 650px;
          height: 75vh;
          background: #181a1f;
          border-radius: 16px;
          box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
          display: flex;
          flex-direction: column;
          overflow: hidden;
          transition: transform 0.3s ease-in-out;
        }

        .chat-container:hover {
          transform: scale(1.01);
        }

        .chat-header {
          background: linear-gradient(135deg, #007bff, #00c6ff);
          color: white;
          padding: 15px;
          text-align: center;
          font-size: 1.4rem;
          font-weight: 600;
          letter-spacing: 0.5px;
          border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chat-box {
          flex-grow: 1;
          overflow-y: auto;
          padding: 20px;
          background: #20232a;
          scrollbar-width: thin;
          scrollbar-color: #444 #20232a;
        }

        .chat-box::-webkit-scrollbar {
          width: 6px;
        }

        .chat-box::-webkit-scrollbar-thumb {
          background-color: #555;
          border-radius: 10px;
        }

        .message {
          padding: 10px 14px;
          margin-bottom: 12px;
          border-radius: 16px;
          max-width: 75%;
          word-wrap: break-word;
          position: relative;
          animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .sent {
          background: linear-gradient(135deg, #007bff, #00c6ff);
          align-self: flex-end;
          margin-left: auto;
          color: white;
          box-shadow: 0 0 10px rgba(0, 123, 255, 0.4);
        }

        .received {
          background: #2c2f38;
          align-self: flex-start;
          margin-right: auto;
          color: #f1f1f1;
        }

        .timestamp {
          display: block;
          font-size: 0.75rem;
          color: #bbb;
          margin-top: 3px;
          text-align: right;
        }

        .input-area {
          display: flex;
          align-items: center;
          padding: 10px 15px;
          background: #181a1f;
          border-top: 1px solid #2a2d34;
        }

        .input-area input {
          background: #23262e;
          color: white;
          border: none;
          padding: 12px;
          margin-right: 10px;
          border-radius: 20px;
          flex-grow: 1;
          outline: none;
        }

        .input-area input::placeholder {
          color: #aaa;
        }

        .btn-send {
          background: linear-gradient(135deg, #007bff, #00c6ff);
          border: none;
          border-radius: 20px;
          padding: 10px 20px;
          font-weight: 600;
          color: #fff;
          transition: 0.2s;
        }

        .btn-send:hover {
          opacity: 0.85;
        }

        .typing {
          font-size: 0.85rem;
          color: #bbb;
          margin: 5px 0 0 10px;
          font-style: italic;
          display: none;
        }
    </style>
</head>

<body>
<div class="chat-container shadow-lg">
    <div class="chat-header">ðŸ’¬ Real-Time Chat Application</div>

    <div id="chatBox" class="chat-box"></div>

    <div class="typing" id="typingIndicator">Someone is typing...</div>

    <div class="input-area">
        <input id="sender" type="text" placeholder="Your name..." />
        <input id="messageInput" type="text" placeholder="Type a message..." />
        <button id="sendBtn" class="btn-send">Send</button>
    </div>
</div>

<!-- SockJS + STOMP -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
    let stompClient = null;
    const chatBox = document.getElementById("chatBox");
    const messageInput = document.getElementById("messageInput");
    const senderInput = document.getElementById("sender");
    const sendBtn = document.getElementById("sendBtn");
    const typingIndicator = document.getElementById("typingIndicator");

    function connect() {
      const socket = new SockJS("/ws");
      stompClient = Stomp.over(socket);

      stompClient.connect({}, function () {
        console.log("Connected to WebSocket");

        stompClient.subscribe("/topic/messages", function (messageOutput) {
          const msg = JSON.parse(messageOutput.body);
          showMessage(msg);
        });
      });
    }

    function showMessage(msg) {
      const div = document.createElement("div");
      div.className =
        msg.sander === senderInput.value ? "message sent" : "message received";
      div.innerHTML = `
        <strong>${msg.sander}</strong><br>${msg.content}
        <span class="timestamp">${new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}</span>
      `;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    sendBtn.addEventListener("click", sendMessage);
    messageInput.addEventListener("keydown", (e) => {
      typingIndicator.style.display = "block";
      setTimeout(() => (typingIndicator.style.display = "none"), 1000);
      if (e.key === "Enter") sendMessage();
    });

    function sendMessage() {
      const sender = senderInput.value.trim();
      const content = messageInput.value.trim();
      if (!sender || !content) return;

      stompClient.send(
        "/app/sendmessage",
        {},
        JSON.stringify({ sander: sender, content: content })
      );
      messageInput.value = "";
    }

    connect();
</script>
</body>
</html>
